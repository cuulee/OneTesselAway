<html>
    <head>
        <style>
            body * {
                font-family: 'Courier New', Courier, monospace;
            }
            h2 {
                margin-block-end: 0.5em;
                margin-block-start: 2em;
            }
            .display {
                background-color: green;
                font-size: 1.2em;
                font-weight: bold;
                padding: 10px;
            }
            .text-area {
                font-size: 0.8em;
                height: 250px;
                padding: 10px;
                width: 100%;
            }
            .led-alarm-set {
                border: 1px solid red;
                display: inline-block;
                height: 20px;
                width: 20px;
            }
        </style>
    </head>
    <body>
        <h1>OneTesselAway Web UI</h1>

        <p>
            This is a simple web UI for the OneTesselAway device. It shows raw
            arrival info and device logs to help with diagnostics.
        </p>

        <h2>Simulated Display</h2>
        <p>
            This is what should be currently displayed on the LCD screen of the
            device:
        </p>
        <pre id="displayLinesJoined" class="display">
<%= displayLinesJoined %></pre
        >
        <form>
            <button>Set Alarm</button>
            <div class="led-alarm-set"></div>
        </form>

        <h2>Arrival Info</h2>
        <p>
            Latest "arrival info" state in memory, from which the display is
            derived
        </p>
        <textarea id="arrivalInfo" class="text-area">
<%= arrivalInfo %>
        </textarea>

        <h2>Device Logs</h2>
        <p>
            Device logs from the OneTesselAway program, latest first.
        </p>
        <textarea id="deviceLogs" class="text-area">
<%= deviceLogs %>
        </textarea>

        <!-- This client library is provided by the server -->
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io.connect();

            // Update the display when the device state updates
            socket.on('deviceStateUpdated', deviceState => {
                Object.keys(deviceState).forEach(stateKey => {
                    const stateValue = deviceState[stateKey];
                    const el = document.querySelector(`#${stateKey}`);
                    if (el) {
                        el.innerHTML = stateValue;
                        console.log(
                            `Updated "#${stateKey}"" with "${stateValue}"`,
                        );
                    }
                });
            });
        </script>
    </body>
</html>
